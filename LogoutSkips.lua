local f = CreateFrame('frame', nil, WorldMapPlayerLower)
f:SetAllPoints()

settings = {
  ['disabled'] = true,
}

local showing = false

local nodes = {}
local minimap = {}
nodes[100000] = {
  [73105000] = 1,
}
nodes[327] = { -- AhnQirajTheFallenKingdom
 [59001430] = {
  id = 743,
  type = "Raid",
  hideOnContinent = true
 }, -- Ruins of Ahn'Qiraj Silithus 36509410, World 42308650
 [46800750] = { id = 744,
  type = "Raid",
  hideOnContinent = true
 }, -- Temple of Ahn'Qiraj Silithus 24308730, World 40908570
}
nodes[63] = { -- Ashenvale
 --[16501100] = { 227,  type = "Dungeon" }, -- Blackfathom Deeps 14101440 May look more accurate
 [14001310] = {
  id = 227,
  type = "Dungeon",
 }, -- Blackfathom Deeps, not at portal but look
}
nodes[15] = { -- Badlands
 [41801130] = { 
  id = 239,
  type = "Dungeon",
 }, -- Uldaman
 [58463690] = { 
  id = 239,
  type = "Dungeon",
  hideOnMinimap = true,
  showInZone = true,
 }, -- Uldaman (Secondary Entrance)
}
minimap[15] = { -- Badlands
 [60683744] = {
  id = 239,
  type = "Dungeon"
 }, -- Uldaman (Secondary Entrance)
}
nodes[10] = { -- Barrens
[42106660] = {
 id = 240,
 type = "Dungeon",
 cont = true,
 }, -- Wailing Caverns
}
nodes[36] = { -- BurningSteppes
 [20303260] = {
  id = { 66, 228, 229, 559, 741, 742 },
  type = "Mixed", 
  hideOnContinent = true,
 }, -- Blackrock mountain dungeons and raids
 [23202630] = {
  id = 73,
  type = "Raid",
  hideOnContinent = true,
 }, -- Blackwind Descent
}
nodes[42] = { -- DeadwindPass
 [46907470] = {
  id = 745,
  type = "Raid",
  hideOnContinent = true,
 }, -- Karazhan
 [46707020] = {
  id = 860,
  type = "Dungeon",
  hideOnContinent = true,
 }, -- Return to Karazhan
}
nodes[66] = { -- Desolace
 [29106250] = {
  id = 232,
  type = "Dungeon",
 }, -- Maraudon 29106250 Door at beginning
}
nodes[27] = { -- DunMorogh
 [35602990] = {
  id = 231,
  type = "Dungeon",
 }, -- Gnomeregan
 [76805120] = {
  type = 1,
 }, -- tram
}
nodes[70] = { -- Dustwallow
 [52907770] = {
  id = 760,
  type = "Raid",
 }, -- Onyxia's Lair
}
nodes[23] = { -- EasternPlaguelands
 [27201160] = {
  id = 236,
  lfgid = 40,
  type = "Dungeon",
 }, -- Stratholme World 52902870
 [43401940] = {
  id = 236,
  lfgid = 274,
  type = "Dungeon", -- Stratholme Service Entrance
  showInZone = true,
 },
}
nodes[69] = { -- Feralas
 [65503530] = {
  id = 230,
  lfgid = 34,
  type = "Dungeon",
  showInZone = true,
  hideOnContinent = true,
 }, -- Dire Maul, probably dire maul east
 [60403070] = {
  id = 230,
  lfgid = 36,
  type = "Dungeon",
  hideOnContinent = true,
  hideOnMinimap = true,
  showInZone = true,
 }, -- Dire Maul West (probably) One spot between the two actual entrances
 -- Captial Gardens, 60.3 31.3; 60.4 30.7; 60.3 30.1; 429
 -- North Maybe?, 62.5 24.9; 
 [62502490] = {
  id = 230,
  lfgid = 38,
  type = "Dungeon",
  hideOnContinent = true,
  showInZone = true,
 }, -- Dire Maul, probaly dire maul north
 [77053693] = {
  id = 230,
  lfgid = 34,
  type = "Dungeon",
  hideOnContinent = true,
  showInZone = true,
 }, -- Dire Maul (at Lariss Pavillion)
}
nodes[85] = { -- Orgrimmar
 [52405800] = {
  id = 226,
  type = "Dungeon",
 }, -- Ragefire Chasm Cleft of Shadow 70104880
}
nodes[32] = { -- SearingGorge
 [41708580] = {
  id = { 66, 228, 229, 559, 741, 742 },
  type = "Mixed",
  hideOnContinent = true,
 },
 [43508120] = {
  id = 73,
  type = "Raid",
  hideOnContinent = true,
 }, -- Blackwind Descent
}

nodes[81] = { -- Silithus
 [36208420] = {
  id = 743,
  type = "Raid",
 }, -- Ruins of Ahn'Qiraj
 [23508620] =  {
  id = 744,
  type = "Raid",
 }, -- Temple of Ahn'Qiraj
}
nodes[21] = { -- Silverpine
 [44806780] = {
  id = 64,
  type = "Dungeon",
 }, -- Shadowfang Keep
}
nodes[199] = { -- SouthernBarrens
 [40909450] = {
  id = 234,
  type = "Dungeon",
 }, -- Razorfen Kraul
}
nodes[84] = { -- StormwindCity
 [42205910] = {
  id = 238,
  type = "Dungeon",
 }, -- The Stockade
 [60301190] = {
  type = 1,
 }, -- tram
}
nodes[50] = { -- StranglethornJungle
 [72203290] = {
  id = 76,
  type = "Dungeon",
 }, -- Zul'Gurub
}
nodes[224] = { -- StranglethornVale Jungle and Cape are subzones of this zone (weird)
 [63402180] = {
  id = 76,
  type = "Dungeon",
 }, -- Zul'Gurub
}
nodes[51] = { -- SwampOfSorrows
 [69505250] = {
  id = 237,
  type = "Dungeon",
 }, -- The Temple of Atal'hakkar
}
nodes[71] = { --Tanaris
 [65604870] = {
  id = { 279, 255, 251, 750, 184, 185, 186, 187 },
  type = "Mixed",
 },
 --[[[61006210] = { "The Culling of Stratholme",
  type = "Dungeon" },  --65604870 May look more accurate and merge all CoT dungeons/raids
 [57006230] = { "The Black Morass",  type = "Dungeon" },
 [54605880] = { 185,  type = "Dungeon" }, -- Well of Eternity
 [55405350] = { "The Escape from Durnholde",  type = "Dungeon" },
 [57004990] = { "The Battle for Mount Hyjal",  type = "Raid" },
 [60905240] = { 184,  type = "Dungeon" }, -- End Time
 [61705190] = { 187,  type = "Raid" }, -- Dragon Soul
 [62705240] = { 186,  type = "Dungeon" }, -- Hour of Twilight Merge END ]]--
 [39202130] = {
  id = 241,
  type = "Dungeon",
 }, -- Zul'Farrak
}
nodes[18] = { -- Tirisfal
 [85303220] = {
  id = 311,
  type = "Dungeon",
  hideOnContinent = true,
 }, -- Scarlet Halls
 [84903060] = {
  id = 316,
  type = "Dungeon",
  hideOnContinent = true,
 }, -- Scarlet Monastery
}
nodes[64] = { -- ThousandNeedles
 [47402360] = {
  id = 233,
  type = "Dungeon",
 }, -- Razorfen Downs
}
nodes[22] = { -- WesternPlaguelands
 [69007290] = {
  id = 246,
  type = "Dungeon",
 }, -- Scholomance World 50903650
}
nodes[52] = { -- Westfall
 --[38307750] = { 63,  type = "Dungeon" }, -- Deadmines 43707320  May look more accurate
 [43107390] = {
  id = 63,
  type = "Dungeon",
 }, -- Deadmines
}

-- Vanilla Continent, For things that should be shown or merged only at the continent level
 nodes[13] = { -- Eastern Kingdoms
  [46603050] = {
   id = { 311, 316 },
   type = "Dungeon",
   cont = true,
  }, -- Scarlet Halls/Monastery
  [47316942] = {
   id = { 66, 73, 228, 229, 559, 741, 742 },
   type = "Mixed",
  }, -- Blackrock mount instances, merged in blackwind descent at continent level
  --[38307750] = { 63,  type = "Dungeon" }, -- Deadmines 43707320,
  [49508190] = {
   id = { 745, 860 }, 
   type = "Mixed",
  }, -- Karazhan/Return to Karazhan
 }
 nodes[12] = { -- Kalimdor
  [44006850] = {
   id = 230,
   type = "Dungeon"
  }, -- 	 Maul
 }
 minimap[69] = { -- Feralas
  [65503530] = {
   id = 230,
   lfgid = 34,
   type = "Dungeon",
   hideOnContinent = true,
  }, -- Dire Maul - Warpwood Quarter
  [62502490] = {
   id = 230,
   lfgid = 38,
   type = "Dungeon",
   hideOnContinent = true,
  }, -- Dire Maul, probaly dire maul north
  [60303130] = {
   id = 230,
   lfgid = 36,
   type = "Dungeon",
   hideOnContinent = true,
  }, -- Dire Maul, probably dire maul west, two entrances to same dungeon
  [60303010] = {
   id = 230,
   lfgid = 36,
   type = "Dungeon",
   hideOnContinent = true,
  }, -- Dire Maul, probably dire maul west
 }

-- Vanilla Subzone maps
nodes[33] = { -- BlackrockMountain
 [71305340] = {
  id = 66,
  type = "Dungeon",
 }, -- Blackrock Caverns
 [38701880] = {
  id = 228,
  type = "Dungeon",
 }, -- Blackrock Depths
 [80504080] = {
  id = 229,
 type = "Dungeon",
 }, -- Lower Blackrock Spire
 [79003350] = {
  id = 559,
  type = "Dungeon",
 }, -- Upper Blackrock Spire
 [54208330] = {
  id = 741,
  type = "Raid",
 }, -- Molten Core
 [64207110] = {
  id = 742,
  type = "Raid",
 }, -- Blackwing Lair
}
nodes[75] = { -- CavernsofTime
 [57608260] = {
  id = 279,
  type = "Dungeon",
 }, -- The Culling of Stratholme
 [36008400] = {
  id = 255,
  type = "Dungeon",
 }, -- The Black Morass
 [26703540] = {
  id = 251,
  type = "Dungeon",
 }, -- Old Hillsbrad Foothills
 [35601540] = {
  id = 750,
  type = "Raid",
 }, -- The Battle for Mount Hyjal
 [57302920] = {
  id = 184,
  type = "Dungeon",
 }, -- End Time
 [22406430] = {
  id = 185,
  type = "Dungeon",
 }, -- Well of Eternity
 [67202930] = {
  id = 186,
  type = "Dungeon",
 }, -- Hour of Twilight
 [61702640] = {
  id = 187,
  type = "Raid",
 }, -- Dragon Soul
}
nodes[55] = { -- DeadminesWestfall
 [25505090] = {
  id = 63,
  type = "Dungeon",
 }, -- Deadmines
}
nodes[67] = { -- MaraudonOutside Wicked Grotto I swapped the lfgid for this one and the 26 one to better match map name
 [78605600] = {
  id = 232,
  lfgid = 272,
  type = "Dungeon",
 }, -- Maraudon 36006430
}
nodes[68] = { -- Maraudon Foulspore Cavern
 [52102390] = {
  id = 232,
  lfgid = 26,
  type = "Dungeon"
 }, -- Maraudon 30205450 

 [44307680] = {
  id = 232,
  lfgid = 273,
  type = "Dungeon",
 },  -- Maraudon
}
nodes[469] = { -- NewTinkertownStart
 [31703450] = {
  id = 231,
  type = "Dungeon",
 }, -- Gnomeregan
}
nodes[30] = { -- New Tinker Town
 [30167457] = {
  id = 231,
  type = "Dungeon"
 }, -- Gnomeregan
 [44631377] = {
  id = 231,
  type = "Dungeon",
 }, -- Gnomeregan
}
nodes[19] = { -- Internal Zone ScarletMonasteryEntrance
 [68802420] = {
  id = 316,
  type = "Dungeon",
 }, -- Scarlet Monastery
 [78905920] = {
  id = 311,
  type = "Dungeon",
 }, -- Scarlet Halls
}
nodes[11] = {
 [55106640] = {
  id = 240,
  type = "Dungeon",
 }, -- Wailing Caverns
}


voronoi_lines_kalimdor ={{-8593.07367997822, 2924.410888671875, -26381.707834878267, -4811.187580793452}, {-8593.07367997822, 2924.410888671875, -4800.705236990402, 4573.567269525559}, {-12066.697211909695, -774.08154296875, -26381.707834878267, -4811.187580793452}, {-12066.697211909695, -774.08154296875, -8073.375909759812, 352.11123218827703}, {-7500.429315716992, 240.7658081054688, -4722.73470252176, -299.04643250214525}, {-7500.429315716992, 240.7658081054688, -8073.375909759812, 352.11123218827703}, {-8073.375909759812, 352.11123218827703, -6158.028033808253, 1237.3052894282487}, {-45485.09174482113, -8115.19970703125, -8202003.855711637, -1335028.7534762134}, {-45485.09174482113, -8115.19970703125, -27531.130163113987, -5194.424845105704}, {-6741.9126708481745, 6857.259765625, -4700.02795073305, 4709.610574077283}, {-6741.9126708481745, 6857.259765625, -244441.24149029853, 256868.8134745661}, {-26381.707834878267, -4811.187580793452, -27531.130163113987, -5194.424845105704}, {-27531.130163113987, -5194.424845105704, -15451.7132911386, -4794.815960774939}, {-5986.432704532165, 1178.063232421875, -3573.0802165793975, 344.870590926738}, {-5986.432704532165, 1178.063232421875, -6158.028033808253, 1237.3052894282487}, {-6158.028033808253, 1237.3052894282487, -5776.190563406767, 1579.2429157177855}, {-5663.866531124684, 1731.335571289063, -5776.190563406767, 1579.2429157177855}, {-5663.866531124684, 1731.335571289063, -5035.730461631591, 2581.8648919369207}, {-5776.190563406767, 1579.2429157177855, -3337.142235611044, 1351.6697905685683}, {-10245.69349667557, -3518.033203125, -15451.7132911386, -4794.815960774939}, {-10245.69349667557, -3518.033203125, -4467.028880254671, -2100.8085985748717}, {-4656.205670372711, -639.0740966796875, -4418.303580164882, -1854.9837442917717}, {-4656.205670372711, -639.0740966796875, -4722.73470252176, -299.04643250214525}, {-15451.7132911386, -4794.815960774939, -7178.570035652826, -5568.831807076151}, {-4722.73470252176, -299.04643250214525, -3573.0802165793975, 344.870590926738}, {-5023.757607638649, 2683.327880859375, -5035.730461631591, 2581.8648919369207}, {-5023.757607638649, 2683.327880859375, -4800.705236990402, 4573.567269525559}, {-5035.730461631591, 2581.8648919369207, -3620.646099810745, 1946.3326504815632}, {-4860.486921173945, -7199.7998046875, -4012.3544911376976, -7947.776243718672}, {-4860.486921173945, -7199.7998046875, -6473.892044014085, -5776.9217543280265}, {-5388.243973767521, -4752.8330078125, -7178.570035652826, -5568.831807076151}, {-5388.243973767521, -4752.8330078125, -4091.3801662425003, -4161.745533704838}, {-7178.570035652826, -5568.831807076151, -6473.892044014085, -5776.9217543280265}, {-4285.604492038416, -8591.2998046875, -72284.3540085382, -168733.2843830684}, {-4285.604492038416, -8591.2998046875, -4012.3544911376976, -7947.776243718672}, {-6473.892044014085, -5776.9217543280265, -5464.267369927114, -5853.500621423901}, {-4003.74714264912, -1073.109497070313, -4418.303580164882, -1854.9837442917717}, {-4003.74714264912, -1073.109497070313, -3423.8039456302567, 20.692479127656252}, {-4619.201251284764, -5530.1328125, -5464.267369927114, -5853.500621423901}, {-4619.201251284764, -5530.1328125, -3116.6125922785236, -4955.161468059686}, {-5464.267369927114, -5853.500621423901, -3651.5795954835385, -6377.913057682999}, {-4016.2908185125734, -4031.133056640625, -4091.3801662425003, -4161.745533704838}, {-4016.2908185125734, -4031.133056640625, -3657.2332308069435, -3406.5784113185214}, {-4091.3801662425003, -4161.745533704838, -3144.0709798413277, -4594.512673664655}, {-4012.3544911376976, -7947.776243718672, -3191.0137198448797, -7762.46550347947}, {-4418.303580164882, -1854.9837442917717, -4467.028880254671, -2100.8085985748717}, {-3739.8212024411728, -3134.083251953125, -3657.2332308069435, -3406.5784113185214}, {-3739.8212024411728, -3134.083251953125, -4005.1380702952542, -2258.6826245055595}, {-4467.028880254671, -2100.8085985748717, -4005.1380702952542, -2258.6826245055595}, {-3657.2332308069435, -3406.5784113185214, -2619.570360477106, -3839.579010883221}, {-3501.9301222404692, 2428.551025390625, -3620.646099810745, 1946.3326504815632}, {-3501.9301222404692, 2428.551025390625, -3131.4089577492723, 3933.589500136709}, {-3489.3731877171062, -6854.7998046875, -3190.8711621280454, -7732.395590930423}, {-3489.3731877171062, -6854.7998046875, -3651.5795954835385, -6377.913057682999}, {-3831.5208050034603, 7412.8798828125, -3217.774691735921, 5354.658659796828}, {-3831.5208050034603, 7412.8798828125, -6155.441951115742, 15206.23892842517}, {-3620.646099810745, 1946.3326504815632, -3337.142235611044, 1351.6697905685683}, {-3651.5795954835385, -6377.913057682999, -2297.658322347584, -5834.917074020045}, {-4800.705236990402, 4573.567269525559, -4700.02795073305, 4709.610574077283}, {-4005.1380702952542, -2258.6826245055595, -2961.821259020238, -2040.422945785632}, {-4700.02795073305, 4709.610574077283, -3583.7536452583763, 4894.762291078128}, {-3139.166260316597, -4658.93310546875, -3116.6125922785236, -4955.161468059686}, {-3139.166260316597, -4658.93310546875, -3144.0709798413277, -4594.512673664655}, {-3144.0709798413277, -4594.512673664655, -2619.570360477106, -3839.579010883221}, {-3117.979551436318, -590.03759765625, -2588.694424180337, -1647.0178534714114}, {-3117.979551436318, -590.03759765625, -3423.8039456302567, 20.692479127656252}, {-3116.6125922785236, -4955.161468059686, -2297.658322347584, -5834.917074020045}, {-2809.112627721616, -7206.90625, -3190.8711621280454, -7732.395590930423}, {-2809.112627721616, -7206.90625, -2126.4849553822914, -6267.271550814561}, {-3573.0802165793975, 344.870590926738, -3433.0765087643113, 357.906802316063}, {-3423.8039456302567, 20.692479127656252, -3433.0765087643113, 357.906802316063}, {-3190.8711621280454, -7732.395590930423, -3191.0137198448797, -7762.46550347947}, {-3191.0137198448797, -7762.46550347947, -2061.2488016341163, -8729.5298375992}, {-3337.142235611044, 1351.6697905685683, -2953.645637630242, 887.3399098266553}, {-3433.0765087643113, 357.906802316063, -2953.645637630242, 887.3399098266553}, {-2690.9762334857037, -2506.110107421875, -2323.277989855988, -3138.3253422286184}, {-2690.9762334857037, -2506.110107421875, -2961.821259020238, -2040.422945785632}, {-2961.821259020238, -2040.422945785632, -2588.694424180337, -1647.0178534714114}, {-2619.570360477106, -3839.579010883221, -2224.1584537749363, -3702.327358021595}, {-2148.6485668823693, -4641.919921875, -2124.8785627123425, -5677.153984181871}, {-2148.6485668823693, -4641.919921875, -2169.6034173703765, -3729.291769159403}, {-2029.0507011007753, -2887.16259765625, -2323.277989855988, -3138.3253422286184}, {-2029.0507011007753, -2887.16259765625, -1189.83851528691, -2170.781609477589}, {-2990.80064316452, 3796.7998046875, -1803.8566471844258, 2642.090652494945}, {-2990.80064316452, 3796.7998046875, -3131.4089577492723, 3933.589500136709}, {-3131.4089577492723, 3933.589500136709, -3583.7536452583763, 4894.762291078128}, {-2323.277989855988, -3138.3253422286184, -2224.1584537749363, -3702.327358021595}, {-2588.694424180337, -1647.0178534714114, -1377.864364256595, -1301.8640825372}, {-2953.645637630242, 887.3399098266553, -1657.6237203244186, 1075.5826709418245}, {-3583.7536452583763, 4894.762291078128, -3251.383629404436, 5226.8970217308715}, {-1886.734486835375, -7348.7392578125, -2061.2488016341163, -8729.5298375992}, {-1886.734486835375, -7348.7392578125, -1800.737198134648, -6668.312289617355}, {-2224.1584537749363, -3702.327358021595, -2169.6034173703765, -3729.291769159403}, {-2681.2167899833994, 5943.0830078125, -3217.774691735921, 5354.658659796828}, {-2681.2167899833994, 5943.0830078125, -1195.4682188825566, 7572.451676896908}, {-2169.6034173703765, -3729.291769159403, -1009.4601326905465, -3818.384813333465}, {-2171.0003053720056, -6154.13330078125, -2126.4849553822914, -6267.271550814561}, {-2171.0003053720056, -6154.13330078125, -2296.51624864261, -5835.12751567122}, {-2126.4849553822914, -6267.271550814561, -1800.737198134648, -6668.312289617355}, {-3217.774691735921, 5354.658659796828, -3251.383629404436, 5226.8970217308715}, {-2297.658322347584, -5834.917074020045, -2296.51624864261, -5835.12751567122}, {-2296.51624864261, -5835.12751567122, -2124.8785627123425, -5677.153984181871}, {-3251.383629404436, 5226.8970217308715, -983.2874900147158, 4786.362158143709}, {-2124.8785627123425, -5677.153984181871, -652.0116534619659, -5058.475078853474}, {-1800.737198134648, -6668.312289617355, -886.2360481400606, -6801.437074188598}, {-1800.515325174439, 2644.9541015625, -1803.8566471844258, 2642.090652494945}, {-1800.515325174439, 2644.9541015625, -645.1359957232663, 3635.0920929625913}, {-1803.8566471844258, 2642.090652494945, -1657.6237203244186, 1075.5826709418245}, {-2061.2488016341163, -8729.5298375992, -778.7967896328428, -11110.834838612094}, {-1188.5626902220336, -2173.1064453125, -884.837549170148, -2726.5609206320137}, {-1188.5626902220336, -2173.1064453125, -1189.83851528691, -2170.781609477589}, {-1189.83851528691, -2170.781609477589, -1364.2875728832053, -1318.7418412615614}, {-764.9156005673799, -6441.96533203125, -886.2360481400606, -6801.437074188598}, {-764.9156005673799, -6441.96533203125, -378.84725245737405, -5298.04718415455}, {-886.2360481400606, -6801.437074188598, -56.587795234806926, -7740.851752334391}, {-893.9765532274889, -2948.868896484375, -924.6566113979745, -3695.1670257028045}, {-893.9765532274889, -2948.868896484375, -884.837549170148, -2726.5609206320137}, {-884.837549170148, -2726.5609206320137, 927.1065479285181, -2259.775281322692}, {-1326.5030491700384, -982.9736328125, -1377.864364256595, -1301.8640825372}, {-1326.5030491700384, -982.9736328125, -1117.1071206563818, 317.11694511973775}, {-1377.864364256595, -1301.8640825372, -1364.2875728832053, -1318.7418412615614}, {-1364.2875728832053, -1318.7418412615614, 813.7103319643423, -1807.3881632445703}, {-930.9859896420774, -4077.75634765625, -660.6600567268455, -4971.233476092757}, {-930.9859896420774, -4077.75634765625, -1009.4601326905465, -3818.384813333465}, {-840.2587534394225, 4299.40673828125, -645.1359957232663, 3635.0920929625913}, {-840.2587534394225, 4299.40673828125, -983.2874900147158, 4786.362158143709}, {-1009.4601326905465, -3818.384813333465, -924.6566113979745, -3695.1670257028045}, {-924.6566113979745, -3695.1670257028045, 388.3001415652944, -3428.9542222590508}, {-983.2874900147158, 4786.362158143709, -43.01750195321962, 5526.770281361658}, {-724.4960774191492, 6736.44287109375, -43.01750195321962, 5526.770281361658}, {-724.4960774191492, 6736.44287109375, -1195.4682188825566, 7572.451676896908}, {-1657.6237203244186, 1075.5826709418245, -1440.4852131458613, 949.4097633021554}, {-645.1359957232663, 3635.0920929625913, 297.14431784433, 3222.7066067215487}, {10.975936698641133, -4428.962890625, -660.6600567268455, -4971.233476092757}, {10.975936698641133, -4428.962890625, 488.3848881440027, -4043.508814098433}, {-1195.4682188825566, 7572.451676896908, -964.8963987299921, 8601.904923721324}, {-1425.0772435581425, 919.282958984375, -1117.1071206563818, 317.11694511973775}, {-1425.0772435581425, 919.282958984375, -1440.4852131458613, 949.4097633021554}, {-1440.4852131458613, 949.4097633021554, 351.72013958715615, 2062.0925389168474}, {-660.6600567268455, -4971.233476092757, -652.0116534619659, -5058.475078853474}, {-652.0116534619659, -5058.475078853474, -378.84725245737405, -5298.04718415455}, {-1117.1071206563818, 317.11694511973775, 585.0719173155047, -140.57238891187012}, {-378.84725245737405, -5298.04718415455, 626.225938549403, -5627.665677590072}, {-2216.418841168, 10394.67578125, -1566.9484580026983, 9601.340054701963}, {-2216.418841168, 10394.67578125, -6155.441951115742, 15206.23892842517}, {484.50149433124136, -4002.23291015625, 488.3848881440027, -4043.508814098433}, {484.50149433124136, -4002.23291015625, 439.264223471229, -3521.4139830393074}, {488.3848881440027, -4043.508814098433, 983.4338523888996, -4645.792009364154}, {480.38444343392644, 4169.38525390625, 331.41787216040063, 3248.7807914774553}, {480.38444343392644, 4169.38525390625, 694.4475076034399, 5492.282132252127}, {239.63834562636652, -6824.0849609375, -56.587795234806926, -7740.851752334391}, {239.63834562636652, -6824.0849609375, 626.225938549403, -5627.665677590072}, {-1106.8456405851855, 9683.345703125, -1566.9484580026983, 9601.340054701963}, {-1106.8456405851855, 9683.345703125, 1448.130234285297, 10138.72751213019}, {-1566.9484580026983, 9601.340054701963, -964.8963987299921, 8601.904923721324}, {438.6866885223537, -3520.3662109375, 439.264223471229, -3521.4139830393074}, {438.6866885223537, -3520.3662109375, 388.3001415652944, -3428.9542222590508}, {439.264223471229, -3521.4139830393074, 983.0959360015622, -3756.7256280662505}, {388.3001415652944, -3428.9542222590508, 927.1065479285181, -2259.775281322692}, {-43.01750195321962, 5526.770281361658, 694.4475076034399, 5492.282132252127}, {-964.8963987299921, 8601.904923721324, 2195.898156546069, 7798.608923773034}, {1002.5626367209319, -3789.099609375, 1287.7668098858376, -4263.406719980082}, {1002.5626367209319, -3789.099609375, 983.0959360015622, -3756.7256280662505}, {983.0959360015622, -3756.7256280662505, 2525.8929304330873, -2918.826342104637}, {-56.587795234806926, -7740.851752334391, -49.982045668694035, -7768.6687770117815}, {-81.72397392920428, -7914.2294921875, -778.7967896328428, -11110.834838612094}, {-81.72397392920428, -7914.2294921875, -49.982045668694035, -7768.6687770117815}, {320.0793729679625, 2734.9677734375, 351.72013958715615, 2062.0925389168474}, {320.0793729679625, 2734.9677734375, 297.14431784433, 3222.7066067215487}, {-49.982045668694035, -7768.6687770117815, 1575.5616607098418, -7196.279411794173}, {297.14431784433, 3222.7066067215487, 331.41787216040063, 3248.7807914774553}, {331.41787216040063, 3248.7807914774553, 8934.416618372532, 5567.72596834814}, {851.9406225523732, 466.6642150878906, 585.0719173155047, -140.57238891187012}, {851.9406225523732, 466.6642150878906, 1349.5341210388312, 1598.895084665075}, {351.72013958715615, 2062.0925389168474, 1349.5341210388312, 1598.895084665075}, {1408.5729255848728, -7981.12890625, -251.20091255292147, -14929.41634456711}, {1408.5729255848728, -7981.12890625, 1559.4844445732344, -7349.370176481942}, {1025.463579449211, -4592.98291015625, 983.4338523888996, -4645.792009364154}, {1025.463579449211, -4592.98291015625, 1287.7668098858376, -4263.406719980082}, {983.4338523888996, -4645.792009364154, 862.4632219433785, -5576.138186736483}, {585.0719173155047, -140.57238891187012, 1068.3200636542363, -654.404092878973}, {1636.4677871266126, -7960.6875, 12779.743096190921, -96448.36562908397}, {1636.4677871266126, -7960.6875, 1559.4844445732344, -7349.370176481942}, {1287.7668098858376, -4263.406719980082, 2434.433985809905, -3710.231098184713}, {626.225938549403, -5627.665677590072, 862.4632219433785, -5576.138186736483}, {896.1851851101057, -1433.906005859375, 813.7103319643423, -1807.3881632445703}, {896.1851851101057, -1433.906005859375, 1068.3200636542363, -654.404092878973}, {813.7103319643423, -1807.3881632445703, 950.5228151745063, -2234.7477341612143}, {694.4475076034399, 5492.282132252127, 4447.776098579999, 6500.489525702152}, {862.4632219433785, -5576.138186736483, 2424.0676353155277, -6093.387820100032}, {1474.7596200800822, 10055.3916015625, 2195.898156546069, 7798.608923773034}, {1474.7596200800822, 10055.3916015625, 1448.130234285297, 10138.72751213019}, {1448.130234285297, 10138.72751213019, 21833.91033271105, 87713.44280313105}, {1559.4844445732344, -7349.370176481942, 1575.5616607098418, -7196.279411794173}, {927.1065479285181, -2259.775281322692, 950.5228151745063, -2234.7477341612143}, {950.5228151745063, -2234.7477341612143, 2464.458117384658, -2865.3424915422625}, {1068.3200636542363, -654.404092878973, 2431.4859807812113, -295.3269921516341}, {-6155.441951115742, 15206.23892842517, -124121.69320225873, 198807.5117016378}, {1575.5616607098418, -7196.279411794173, 2697.5124661096665, -6380.683460544502}, {1349.5341210388312, 1598.895084665075, 5305.829379546071, 1925.1090491419727}, {2445.935740184116, -1421.614501953125, 2464.458117384658, -2865.3424915422625}, {2445.935740184116, -1421.614501953125, 2431.4859807812113, -295.3269921516341}, {-778.7967896328428, -11110.834838612094, -251.20091255292147, -14929.41634456711}, {2430.5639244084687, -4599.93310546875, 2424.0676353155277, -6093.387820100032}, {2430.5639244084687, -4599.93310546875, 2434.433985809905, -3710.231098184713}, {2434.433985809905, -3710.231098184713, 2705.519639861179, -3046.3813577030737}, {2431.4859807812113, -295.3269921516341, 5305.829379546071, 1925.1090491419727}, {2464.458117384658, -2865.3424915422625, 2525.8929304330873, -2918.826342104637}, {2525.8929304330873, -2918.826342104637, 2705.519639861179, -3046.3813577030737}, {2424.0676353155277, -6093.387820100032, 2697.5124661096665, -6380.683460544502}, {2705.519639861179, -3046.3813577030737, 293989.18715627777, 24854.274552690666}, {2195.898156546069, 7798.608923773034, 4447.776098579999, 6500.489525702152}, {2697.5124661096665, -6380.683460544502, 49912.99218217466, -27602.718747271454}, {-251.20091255292147, -14929.41634456711, 9747.962210664955, -99824.6381547569}, {4447.776098579999, 6500.489525702152, 8934.416618372532, 5567.72596834814}, {5305.829379546071, 1925.1090491419727, 13257.437296268594, 5073.418043984301}, {8934.416618372532, 5567.72596834814, 13257.437296268594, 5073.418043984301}, {13257.437296268594, 5073.418043984301, 293989.18715627777, 24854.274552690666}, {293989.18715627777, 24854.274552690666, 51971.89478202164, 6472.168369136885}}

local voronoi_lines = {{-8005.920467441588, -285.0833435058594, -23139.280291673855, -6029.418550274445}, {-8005.920467441588, -285.0833435058594, -4891.5237284700215, 897.0823515748257}, {-4764.693358137905, 2641.27685546875, -4482.535889589459, 1951.936608155831}, {-4764.693358137905, 2641.27685546875, -4997.914018235832, 3211.0593543600876}, {-5070.701020836656, 3299.2373046875, -4997.914018235832, 3211.0593543600876}, {-5070.701020836656, 3299.2373046875, -202738.3631438323, 242764.09599114905}, {-4997.914018235832, 3211.0593543600876, -3372.357464551504, 2840.959855841158}, {-57605.18980879716, -10423.6455078125, -16253252.508402215, -1924603.5843191654}, {-57605.18980879716, -10423.6455078125, -26837.05959529338, -6787.129075288738}, {-4669.1678718620815, 1380.336181640625, -4891.5237284700215, 897.0823515748257}, {-4669.1678718620815, 1380.336181640625, -4497.818835212437, 1752.7350898691975}, {-4415.807779728376, 1989.253051757813, -4482.535889589459, 1951.936608155831}, {-4415.807779728376, 1989.253051757813, -3189.09069929527, 2675.2715654377057}, {-4482.535889589459, 1951.936608155831, -4497.818835212437, 1752.7350898691975}, {-4497.818835212437, 1752.7350898691975, -3097.8514748750795, 1637.0425539778455}, {-4891.5237284700215, 897.0823515748257, -3379.0239894622127, 273.19745692698734}, {-25443.172940970286, -6501.50830078125, -26837.05959529338, -6787.129075288738}, {-25443.172940970286, -6501.50830078125, -23139.280291673855, -6029.418550274445}, {-26837.05959529338, -6787.129075288738, -3880.6244343584267, -8447.71835418289}, {-23139.280291673855, -6029.418550274445, -12463.911899708091, -4562.083048695352}, {-4046.8729551868155, -6282.4423828125, -3144.0913410200556, -6466.961996757265}, {-4046.8729551868155, -6282.4423828125, -12463.911899708091, -4562.083048695352}, {-3623.020641254484, -10575.033203125, -4189.267796233874, -12221.438602391145}, {-3623.020641254484, -10575.033203125, -3216.0650094064, -9391.779665081465}, {-12463.911899708091, -4562.083048695352, -6533.91219337343, -3672.9566313678097}, {-3584.1426620676175, 3500.57470703125, -3372.357464551504, 2840.959855841158}, {-3584.1426620676175, 3500.57470703125, -52906.167389017435, 157116.315477504}, {-3360.868026986792, -6076.974609375, -3144.0913410200556, -6466.961996757265}, {-3360.868026986792, -6076.974609375, -3679.7819176642065, -5503.239502804159}, {-3244.9474918495466, -10836.005859375, -4056.2574149673005, -12155.34687440989}, {-3244.9474918495466, -10836.005859375, -2712.258888071991, -9969.75499373215}, {-3915.7486111068524, -5351.919921875, -3679.7819176642065, -5503.239502804159}, {-3915.7486111068524, -5351.919921875, -6533.91219337343, -3672.9566313678097}, {-3679.7819176642065, -5503.239502804159, -2528.566603966779, -5863.786619496722}, {-3144.0913410200556, -6466.961996757265, -2919.1624532687997, -6686.530925959249}, {-3372.357464551504, 2840.959855841158, -3189.09069929527, 2675.2715654377057}, {-3903.2118600083045, -1467.973266601563, -4670.56599636857, -2611.588685443537}, {-3903.2118600083045, -1467.973266601563, -3188.414966661892, -402.68579392478466}, {-3130.2432478293763, 1276.86669921875, -3197.7592508476614, 526.1318094879742}, {-3130.2432478293763, 1276.86669921875, -3097.8514748750795, 1637.0425539778455}, {-6533.91219337343, -3672.9566313678097, -6113.231951548069, -3548.753818622164}, {-3097.8514748750795, 1637.0425539778455, -2540.196805337316, 2498.272377516252}, {-5728.649411325319, -3298.926513671875, -6113.231951548069, -3548.753818622164}, {-5728.649411325319, -3298.926513671875, -4670.56599636857, -2611.588685443537}, {-6113.231951548069, -3548.753818622164, -2315.1859461561, -4403.205895370628}, {-2487.5908580889663, 1238.453247070313, -2634.484202146806, 717.2025076631076}, {-2487.5908580889663, 1238.453247070313, -2119.696915978171, 2543.924169382318}, {-4709.365893605799, -12568.37109375, -555599.2062130257, -380040.55707566335}, {-4709.365893605799, -12568.37109375, -4189.267796233874, -12221.438602391145}, {-3189.09069929527, 2675.2715654377057, -2540.196805337316, 2498.272377516252}, {-4189.267796233874, -12221.438602391145, -4056.2574149673005, -12155.34687440989}, {-4056.2574149673005, -12155.34687440989, -2693.5503460752107, -11710.057026960492}, {-4670.56599636857, -2611.588685443537, -1600.6603602629634, -2284.7909961899036}, {-2948.7310509812887, -6806.97265625, -3077.747591874588, -7332.495563099016}, {-2948.7310509812887, -6806.97265625, -2919.1624532687997, -6686.530925959249}, {-2919.1624532687997, -6686.530925959249, -2414.880471716786, -6113.284900089113}, {-3342.442152068792, 324.2432556152344, -3379.0239894622127, 273.19745692698734}, {-3342.442152068792, 324.2432556152344, -3197.7592508476614, 526.1318094879742}, {-3379.0239894622127, 273.19745692698734, -3188.414966661892, -402.68579392478466}, {-3197.7592508476614, 526.1318094879742, -2634.484202146806, 717.2025076631076}, {-3199.0012126864617, -7500.9208984375, -3880.6244343584267, -8447.71835418289}, {-3199.0012126864617, -7500.9208984375, -3077.747591874588, -7332.495563099016}, {-3077.747591874588, -7332.495563099016, -1795.9134130390473, -7066.559837703297}, {-2634.484202146806, 717.2025076631076, -2053.3922843374976, 835.9576643936194}, {-3214.1806756304386, -9393.94140625, -2712.258888071991, -9969.75499373215}, {-3214.1806756304386, -9393.94140625, -3216.0650094064, -9391.779665081465}, {-3216.0650094064, -9391.779665081465, -3697.49439420568, -8552.477065554023}, {-2519.306833902149, -11111.666015625, -2693.5503460752107, -11710.057026960492}, {-2519.306833902149, -11111.666015625, -2498.7694689179953, -11041.136132189065}, {-2497.8269507046534, -11036.666015625, -2498.7694689179953, -11041.136132189065}, {-2497.8269507046534, -11036.666015625, -2325.494443360748, -10219.33815426334}, {-2498.7694689179953, -11041.136132189065, -1920.8462651538982, -11079.665286403555}, {-3188.414966661892, -402.68579392478466, -1849.8416803963194, -699.7329120583537}, {-2459.418774380309, -5558.14990234375, -2528.566603966779, -5863.786619496722}, {-2459.418774380309, -5558.14990234375, -2246.2347036054907, -4615.866103552304}, {-3880.6244343584267, -8447.71835418289, -3697.49439420568, -8552.477065554023}, {-2528.566603966779, -5863.786619496722, -2414.880471716786, -6113.284900089113}, {-1919.6756784694537, -11103, -1878.5405503699417, -11922.996029093967}, {-1919.6756784694537, -11103, -1920.8462651538982, -11079.665286403555}, {-1920.8462651538982, -11079.665286403555, -1711.5914589678086, -10550.487157448193}, {-3697.49439420568, -8552.477065554023, -1611.3039515477553, -8416.695437942531}, {-2712.258888071991, -9969.75499373215, -2325.494443360748, -10219.33815426334}, {-2693.5503460752107, -11710.057026960492, -1878.5405503699417, -11922.996029093967}, {-2414.880471716786, -6113.284900089113, -1815.3434450521331, -6261.531592711944}, {-2028.5618779628492, 902.1932373046875, -2053.3922843374976, 835.9576643936194}, {-2028.5618779628492, 902.1932373046875, -1658.32872707745, 1889.7970843606063}, {-2053.3922843374976, 835.9576643936194, -1582.2652660816632, 257.06783163972455}, {-2325.494443360748, -10219.33815426334, -1875.6394357085007, -10213.560225798083}, {-1714.2102023688742, -9554.236328125, -1875.6394357085007, -10213.560225798083}, {-1714.2102023688742, -9554.236328125, -1460.5157103961901, -8518.074303408472}, {-2540.196805337316, 2498.272377516252, -2180.1619511610866, 2609.656587799491}, {-1741.2111751076948, -7307.849609375, -1679.4293732627782, -7580.367104533681}, {-1741.2111751076948, -7307.849609375, -1795.9134130390473, -7066.559837703297}, {-2017.6027996395712, -4833.04345703125, -1411.4186884564213, -5408.857500058979}, {-2017.6027996395712, -4833.04345703125, -2246.2347036054907, -4615.866103552304}, {-2246.2347036054907, -4615.866103552304, -2315.1859461561, -4403.205895370628}, {-1331.7166817541154, -7376.2744140625, -1679.4293732627782, -7580.367104533681}, {-1331.7166817541154, -7376.2744140625, -921.6921393979134, -7135.607294189462}, {-1795.9134130390473, -7066.559837703297, -1652.4280821503633, -6781.3517667866145}, {-1679.4293732627782, -7580.367104533681, -1587.8168642634243, -8235.816375330718}, {-2315.1859461561, -4403.205895370628, -1658.2284078231023, -3915.6813319560697}, {-1595.7195863967293, -10779.025390625, -1132.6325390787958, -11692.388515365941}, {-1595.7195863967293, -10779.025390625, -1711.5914589678086, -10550.487157448193}, {-1711.5914589678086, -10550.487157448193, -1810.2703642011397, -10241.499031803694}, {-1759.7232700071113, -6439.0009765625, -1652.4280821503633, -6781.3517667866145}, {-1759.7232700071113, -6439.0009765625, -1815.3434450521331, -6261.531592711944}, {-1815.3434450521331, -6261.531592711944, -1291.193882150438, -5746.631874963864}, {-1878.5405503699417, -11922.996029093967, -1261.8327831081688, -12155.874066006958}, {-1875.6394357085007, -10213.560225798083, -1810.2703642011397, -10241.499031803694}, {-1652.4280821503633, -6781.3517667866145, -799.6047427894329, -6956.55946157593}, {-1659.7642469565828, -20.05331420898438, -1849.8416803963194, -699.7329120583537}, {-1659.7642469565828, -20.05331420898438, -1582.2652660816632, 257.06783163972455}, {-1810.2703642011397, -10241.499031803694, -525.1314150663267, -10059.822773004078}, {-1145.9451093216112, -7544.6474609375, -1347.810748810072, -7912.852862476463}, {-1145.9451093216112, -7544.6474609375, -921.6921393979134, -7135.607294189462}, {-1582.2652660816632, 257.06783163972455, -993.9739843610887, 589.401891797961}, {-1216.5778674938863, -5165.134765625, -1411.4186884564213, -5408.857500058979}, {-1216.5778674938863, -5165.134765625, -613.0031804942596, -4410.134491945344}, {-992.7844110203868, -7667.62890625, -1347.810748810072, -7912.852862476463}, {-992.7844110203868, -7667.62890625, -96.6073174039127, -7048.6210496938775}, {-1638.4328837978035, -3354.87841796875, -1658.2284078231023, -3915.6813319560697}, {-1638.4328837978035, -3354.87841796875, -1600.6603602629634, -2284.7909961899036}, {-1411.4186884564213, -5408.857500058979, -1291.193882150438, -5746.631874963864}, {-2112.6334804482517, 2867.474609375, -2180.1619511610866, 2609.656587799491}, {-2112.6334804482517, 2867.474609375, -1990.5728109688848, 3333.491979310362}, {-876.3899163147519, 2915.6748046875, -605.2885243020067, 2814.012125974188}, {-876.3899163147519, 2915.6748046875, -1990.5728109688848, 3333.491979310362}, {-1347.810748810072, -7912.852862476463, -1587.8168642634243, -8235.816375330718}, {-2180.1619511610866, 2609.656587799491, -2119.696915978171, 2543.924169382318}, {-2119.696915978171, 2543.924169382318, -1739.586357672673, 2172.250705823172}, {-1849.8416803963194, -699.7329120583537, -1685.5312277192593, -884.5757675316229}, {-1990.5728109688848, 3333.491979310362, 18909.737011742956, 90350.75965062811}, {-1509.4775366010888, 1739.594970703125, -935.9474076264183, 1160.8596757917685}, {-1509.4775366010888, 1739.594970703125, -1658.32872707745, 1889.7970843606063}, {-1658.2284078231023, -3915.6813319560697, -609.5904305822238, -4232.540111244238}, {-1587.8168642634243, -8235.816375330718, -1611.3039515477553, -8416.695437942531}, {-1658.32872707745, 1889.7970843606063, -1739.586357672673, 2172.250705823172}, {-1401.9254430316635, -721.066650390625, -1685.5312277192593, -884.5757675316229}, {-1401.9254430316635, -721.066650390625, -159.5759759757543, -4.8067025808027575}, {-1739.586357672673, 2172.250705823172, -1123.3895520625815, 2253.7190062344653}, {-1685.5312277192593, -884.5757675316229, -1281.664273830171, -1983.8656891953126}, {-1291.193882150438, -5746.631874963864, -1203.1305347539594, -5763.145744160868}, {-1611.3039515477553, -8416.695437942531, -1460.5157103961901, -8518.074303408472}, {-800.4316717179049, 2602.977294921875, -1123.3895520625815, 2253.7190062344653}, {-800.4316717179049, 2602.977294921875, -605.2885243020067, 2814.012125974188}, {-1068.2070685812837, -5670.11181640625, -1203.1305347539594, -5763.145744160868}, {-1068.2070685812837, -5670.11181640625, -357.9087961546195, -5180.339058296108}, {-1203.1305347539594, -5763.145744160868, -376.33170707006565, -6394.438088176959}, {-921.6921393979134, -7135.607294189462, -799.6047427894329, -6956.55946157593}, {-1123.3895520625815, 2253.7190062344653, -256.5960730701786, 2116.2597791172634}, {-1460.5157103961901, -8518.074303408472, -1114.0228466241463, -8610.99739856962}, {-973.537291729415, 790.6666870117188, -993.9739843610887, 589.401891797961}, {-973.537291729415, 790.6666870117188, -935.9474076264183, 1160.8596757917685}, {-993.9739843610887, 589.401891797961, -159.5759759757543, -4.8067025808027575}, {-605.2885243020067, 2814.012125974188, 242.12335451621573, 3540.190307622094}, {-935.9474076264183, 1160.8596757917685, -188.87056563833718, 1360.3064232816275}, {-1600.6603602629634, -2284.7909961899036, -1281.664273830171, -1983.8656891953126}, {-1019.1950107868267, -11550.3486328125, -1132.6325390787958, -11692.388515365941}, {-1019.1950107868267, -11550.3486328125, -435.0348272016354, -10818.897188848769}, {-1132.6325390787958, -11692.388515365941, -1261.8327831081688, -12155.874066006958}, {-799.6047427894329, -6956.55946157593, -282.7396558475653, -6877.659986560798}, {-946.6210593175329, -8923.974609375, -578.0416322228447, -9613.076935630648}, {-946.6210593175329, -8923.974609375, -1114.0228466241463, -8610.99739856962}, {-1114.0228466241463, -8610.99739856962, -190.7234866398351, -8116.849136399568}, {-1261.8327831081688, -12155.874066006958, -826.8053786679864, -13078.102753463525}, {-464.4036957225878, -4858.7998046875, -357.9087961546195, -5180.339058296108}, {-464.4036957225878, -4858.7998046875, -613.0031804942596, -4410.134491945344}, {-1281.664273830171, -1983.8656891953126, 876.6750618624978, -2191.1919717990236}, {-357.9087961546195, -5180.339058296108, 123.92332857575899, -5522.847241446241}, {-257.5729665839923, -9341.0625, -578.0416322228447, -9613.076935630648}, {-257.5729665839923, -9341.0625, 311.4527448408766, -8858.072353540583}, {-613.0031804942596, -4410.134491945344, -609.5904305822238, -4232.540111244238}, {-578.0416322228447, -9613.076935630648, -517.5617419900133, -10047.82894432941}, {-230.00410082191505, 1819.439697265625, -188.87056563833718, 1360.3064232816275}, {-230.00410082191505, 1819.439697265625, -256.5960730701786, 2116.2597791172634}, {-1604.1011276757267, -14286.203125, -130257.47413817498, -214243.79704187767}, {-1604.1011276757267, -14286.203125, -826.8053786679864, -13078.102753463525}, {-460.72596775902605, -10602.4462890625, -435.0348272016354, -10818.897188848769}, {-460.72596775902605, -10602.4462890625, -525.1314150663267, -10059.822773004078}, {-609.5904305822238, -4232.540111244238, 1723.94080740406, -2845.8845717293634}, {-256.5960730701786, 2116.2597791172634, -64.25522879243475, 2301.4259129203165}, {-435.0348272016354, -10818.897188848769, 660.761350834155, -11422.21787911081}, {-241.76580746543425, -6159.98486328125, -376.33170707006565, -6394.438088176959}, {-241.76580746543425, -6159.98486328125, 123.92332857575899, -5522.847241446241}, {-376.33170707006565, -6394.438088176959, -282.7396558475653, -6877.659986560798}, {-188.87056563833718, 1360.3064232816275, 623.3646357037005, 856.6778813802337}, {-525.1314150663267, -10059.822773004078, -517.5617419900133, -10047.82894432941}, {-517.5617419900133, -10047.82894432941, 718.843236313227, -9921.90141121081}, {-52.55757710097561, 2348.722412109375, -64.25522879243475, 2301.4259129203165}, {-52.55757710097561, 2348.722412109375, 242.12335451621573, 3540.190307622094}, {-64.25522879243475, 2301.4259129203165, 933.263702008349, 1785.5838814204726}, {-0.1901620409935689, -8385.5166015625, 306.903750359444, -8818.543964021565}, {-0.1901620409935689, -8385.5166015625, -190.7234866398351, -8116.849136399568}, {-190.7234866398351, -8116.849136399568, 219.961256439824, -7297.831877767216}, {-282.7396558475653, -6877.659986560798, -96.6073174039127, -7048.6210496938775}, {-159.5759759757543, -4.8067025808027575, 395.84439949437797, -68.43658110801384}, {123.92332857575899, -5522.847241446241, 6041.909950390297, -4263.987561060989}, {324.20205125147197, -8808.595703125, 306.903750359444, -8818.543964021565}, {324.20205125147197, -8808.595703125, 3597.1066434295926, -6926.346748399345}, {306.903750359444, -8818.543964021565, 311.4527448408766, -8858.072353540583}, {-826.8053786679864, -13078.102753463525, 983.9094448103363, -12739.385685377682}, {311.4527448408766, -8858.072353540583, 992.6137063695217, -9687.742953798392}, {-96.6073174039127, -7048.6210496938775, 219.961256439824, -7297.831877767216}, {749.1748982212994, -10558.966796875, 777.3564131247955, -11150.871972232993}, {749.1748982212994, -10558.966796875, 718.843236313227, -9921.90141121081}, {219.961256439824, -7297.831877767216, 3597.1066434295926, -6926.346748399345}, {242.12335451621573, 3540.190307622094, 19738.893539199275, 48107.197722053665}, {827.1447282823083, -11124.333984375, 777.3564131247955, -11150.871972232993}, {827.1447282823083, -11124.333984375, 5364.556349536069, -8705.819235872423}, {777.3564131247955, -11150.871972232993, 660.761350834155, -11422.21787911081}, {718.843236313227, -9921.90141121081, 992.6137063695217, -9687.742953798392}, {660.761350834155, -11422.21787911081, 983.9094448103363, -12739.385685377682}, {432.8331308106411, -231.7332153320313, 876.6750618624978, -2191.1919717990236}, {432.8331308106411, -231.7332153320313, 395.84439949437797, -68.43658110801384}, {395.84439949437797, -68.43658110801384, 515.0959046886622, 163.3371482133865}, {563.9364862590122, 476.1067199707031, 515.0959046886622, 163.3371482133865}, {563.9364862590122, 476.1067199707031, 623.3646357037005, 856.6778813802337}, {515.0959046886622, 163.3371482133865, 177149.4503679749, -6649.116149592836}, {972.5639260963438, 1882.387329101563, 933.263702008349, 1785.5838814204726}, {972.5639260963438, 1882.387329101563, 19738.893539199275, 48107.197722053665}, {933.263702008349, 1785.5838814204726, 959.1456442091244, 1200.7526436120427}, {623.3646357037005, 856.6778813802337, 959.1456442091244, 1200.7526436120427}, {992.6137063695217, -9687.742953798392, 5364.556349536069, -8705.819235872423}, {959.1456442091244, 1200.7526436120427, 261107.70488240398, -7282.638197050813}, {983.9094448103363, -12739.385685377682, 52825.13369226662, -32818.9508950836}, {876.6750618624978, -2191.1919717990236, 1723.94080740406, -2845.8845717293634}, {1723.94080740406, -2845.8845717293634, 6041.909950390297, -4263.987561060989}, {3597.1066434295926, -6926.346748399345, 11656.485229409038, -5441.058250958402}, {5364.556349536069, -8705.819235872423, 15208.65440873463, -5753.627077993576}, {6041.909950390297, -4263.987561060989, 11656.485229409038, -5441.058250958402}, {11656.485229409038, -5441.058250958402, 15208.65440873463, -5753.627077993576}, {15208.65440873463, -5753.627077993576, 177149.4503679749, -6649.116149592836}, {19738.893539199275, 48107.197722053665, 30714.181366122928, 74073.51198671827}, {177149.4503679749, -6649.116149592836, 261107.70488240398, -7282.638197050813}, {261107.70488240398, -7282.638197050813, 54858.05120416649, -5167.424367236246}}



newToUiMapId = {
    [27] = 1426, -- Dun Morogh
    [15] = 1418, -- Badlands
    [51] = 1435, -- Swamp of Sorrows
    [70] = 1445, -- Dustwallow Marsh
    [10] = 1413, -- The Barrens
    [22] = 1422, -- Western Plaguelands
    [50] = 1434, -- Stranglethorn Vale
    [38] = 1432, -- Loch Modan
    [52] = 1436, -- Westfall
    [42] = 1430, -- Deadwind Pass
    [36] = 1428, -- Burning Steppes
    [32] = 1427, -- Searing Gorge
    [18] = 1420, -- Tirisfal Glades
    [21] = 1421, -- Silverpine Forest
    [23] = 1423, -- Eastern Plaguelands
    [63] = 1440, -- Ashenvale
    [69] = 1444, -- Feralas
    [64] = 1441, -- Thousand Needles
    [66] = 1443, -- Desolace
    [71] = 1446, -- Tanaris
    [81] = 1451, -- Silithus
    [84] = 1453, -- Stormwind City
    [85] = 1454, -- Orgrimmar
    [100000] = 1455, -- Ironforge
}

areaIdToUiMapId = {
    [1] = 1426, -- Dun Morogh
    [3] = 1418, -- Badlands
    [4] = 1419, -- Blasted Lands
    [8] = 1435, -- Swamp of Sorrows
    [10] = 1431, -- Duskwood
    [11] = 1437, -- Wetlands
    [12] = 1429, -- Elwynn Forest
    [14] = 1411, -- Durotar
    [15] = 1445, -- Dustwallow Marsh
    [16] = 1447, -- Azshara
    [17] = 1413, -- The Barrens
    [28] = 1422, -- Western Plaguelands
    [33] = 1434, -- Stranglethorn Vale
    [36] = 1416, -- Alterac Mountains
    [38] = 1432, -- Loch Modan
    [40] = 1436, -- Westfall
    [41] = 1430, -- Deadwind Pass
    [44] = 1433, -- Redridge Mountains
    [45] = 1417, -- Arathi Highlands
    [46] = 1428, -- Burning Steppes
    [47] = 1425, -- The Hinterlands
    [51] = 1427, -- Searing Gorge
    [65] = 115, -- Dragonblight
    [66] = 121, -- Zul'Drak
    [67] = 120, -- The Storm Peaks
    [85] = 1420, -- Tirisfal Glades
    [130] = 1421, -- Silverpine Forest
    [139] = 1423, -- Eastern Plaguelands
    [141] = 1438, -- Teldrassil
    [148] = 1439, -- Darkshore
    [206] = 133, -- Utgarde Keep - Dungeon
    [209] = 310, -- Shadowfang Keep - Dungeon
    [210] = 118, -- Icecrown
    [215] = 1412, -- Mulgore
    [267] = 1424, -- Hillsbrad Foothills
    [331] = 1440, -- Ashenvale
    [357] = 1444, -- Feralas
    [361] = 1448, -- Felwood
    [394] = 116, -- Grizzly Hills
    [400] = 1441, -- Thousand Needles
    [405] = 1443, -- Desolace
    [406] = 1442, -- Stonetalon Mountains
    [440] = 1446, -- Tanaris
    [490] = 1449, -- Un'Goro Crater
    [491] = 301, -- Razorfen Kraul - Dungeon
    [493] = 1450, -- Moonglade
    [495] = 117, -- Howling Fjord
    [618] = 1452, -- Winterspring
    [717] = 225, -- The Stockade - Dungeon
    [718] = 279, -- Wailing Caverns - Dungeon
    [719] = 221, -- Blackfathom Deeps - Dungeon
    [721] = 226, -- Gnomeregan - Dungeon
    [722] = 300, -- Razorfen Downs - Dungeon
    [796] = 302, -- Scarlet Monastery - Dungeon
    [1176] = 219, -- Zul'Farrak - Dungeon
    [1196] = 136, -- Utgarde Pinnacle - Dungeon
    [1337] = 230, -- Uldaman - Dungeon
    [1377] = 1451, -- Silithus
    [1477] = 220, -- The Temple of Atal'Hakkar - Dungeon
    [1497] = 1458, -- Undercity
    [1519] = 1453, -- Stormwind City
    [1537] = 1455, -- Ironforge
    [1581] = 291, -- The Deadmines - Dungeon
    [1583] = 250, -- Blackrock Spire - Dungeon
    [1584] = 242, -- Blackrock Depths - Dungeon
    [1637] = 1454, -- Orgrimmar
    [1638] = 1456, -- Thunder Bluff
    [1657] = 1457, -- Darnassus
    [1977] = 233, -- Zul'Gurub - Raid
    [2017] = 317, -- Stratholme - Dungeon
    [2100] = 280, -- Maraudon - Dungeon
    [2159] = 248, -- Onyxia's Lair - Dungeon?
    [2366] = 273, -- The Black Morass - Dungeon
    [2367] = 274, -- Old Hillsbrad Foothills - Dungeon
    [2437] = 213, -- Ragefire Chasm - Dungeon
    [2557] = 234, -- Dire Maul - Dungeon
    [2597] = 1459, -- Alterac Valley - Battleground
    [2677] = 287, -- Blackwing Lair - Raid
    [2717] = 232, -- Molten Core - Raid
    [2817] = 127, -- Crystalsong Forest
    [3277] = 1460, -- Warsong Gulch - Battleground
    [3358] = 1461, -- Arathi Basin - Battleground
    [3428] = 319, -- Ahn'Qiraj - Raid
    [3429] = 247, -- Ruins of Ahn'Qiraj - Raid
    [3430] = 1941, -- Eversong Woods
    [3433] = 1942, -- Ghostlands
    [3456] = 162, -- Naxxramas - Raid
    [3457] = 350, -- Karazhan - Raid
    [3483] = 1944, -- Hellfire Peninsula
    [3487] = 1954, -- Silvermoon City
    [3518] = 1951, -- Nagrand
    [3519] = 1952, -- Terokkar Forest
    [3520] = 1948, -- Shadowmoon Valley
    [3521] = 1946, -- Zangarmarsh
    [3522] = 1949, -- Blade's Edge Mountains
    [3523] = 1953, -- Netherstorm
    [3524] = 1943, -- Azuremyst Isle
    [3525] = 1950, -- Bloodmyst Isle
    [3535] = 246, -- Hellfire Citadel - Dungeon This is hellfire citadel area in The Shattered halls, have to have it because mobs use this AreaId
    [3537] = 114, -- Borean Tundra
    [3557] = 1947, -- The Exodar
    [3562] = 347, -- Hellfire Ramparts - Dungeon
    [3606] = 329, -- Hyjal Summit - Raid
    [3607] = 332, -- Serpentshrine Cavern - Raid
    [3703] = 1955, -- Shattrath City
    [3711] = 119, -- Sholazar Basin
    [3713] = 261, -- The Blood Furnace - Dungeon
    [3714] = 246, -- The Shattered Halls - Dungeon
    [3715] = 263, -- The Steamvault - Dungeon
    [3716] = 262, -- The Underbog - Dungeon
    [3717] = 265, -- The Slave Pens - Dungeon
    [3789] = 260, -- Shadow Labyrinth - Dungeon
    [3790] = 256, -- Auchenai Crypts - Dungeon
    [3791] = 258, -- Sethekk Halls - Dungeon
    [3792] = 272, -- Mana-Tombs - Dungeon
    [3805] = 333, -- Zul'Aman - Raid
    [3820] = 1956, -- Eye of the Storm - Battleground
    [3836] = 331, -- Magtheridon's Lair - Raid
    [3845] = 334, -- Tempest Keep - Raid
    [3847] = 266, -- The Botanica - Dungeon
    [3848] = 269, -- The Arcatraz - Dungeon
    [3849] = 267, -- The Mechanar - Dungeon
    [3923] = 330, -- Gruul's Lair - Raid
    [3959] = 339, -- Black Temple - Raid
    [4075] = 335, -- Sunwell Plateau - Raid
    [4080] = 1957, -- Isle of Quel'Danas
    [4100] = 130, -- The Culling of Stratholme - Dungeon
    [4196] = 160, -- Drak'Tharon Keep - Dungeon
    [4197] = 123, -- Wintergrasp
    [4228] = 142, -- The Oculus - Dungeon
    [4264] = 140, -- Halls of Stone - Dungeon
    [4265] = 129, -- The Nexus - Dungeon
    [4272] = 138, -- Halls of Lightning - Dungeon
    [4273] = 147, -- Ulduar - Raid
    [4277] = 157, -- Azjol-Nerub - Dungeon
    [4298] = 124, -- Plaguelands: The Scarlet Enclave
    [4384] = 128, -- Strand of the Ancients - Battleground
    [4395] = 125, -- Dalaran - Dungeon?
    [4415] = 168, -- The Violet Hold - Dungeon
    [4416] = 153, -- Gundrak - Dungeon
    [4493] = 155, -- The Obsidian Sanctum - Raid
    [4494] = 132, -- Ahn'kahet: The Old Kingdom - Dungeon
    [4500] = 141, -- The Eye of Eternity - Raid
    [4560] = 126, -- The Underbelly - Sub zone of Dalaran
    [4603] = 156, -- Vault of Archavon - Raid
    [4710] = 169, -- Isle of Conquest - Battleground
    [4722] = 172, -- Trial of the Crusader - Raid
    [4723] = 171, -- Trial of the Champion - Dungeon
    [4742] = 170, -- Hrothgar's Landing
    [4809] = 183, -- The Forge of Souls - Dungeon
    [4812] = 186, -- Icecrown Citadel - Raid
    [4813] = 184, -- Pit of Saron - Dungeon
    [4820] = 185, -- Halls of Reflection - Dungeon
    [4987] = 200, -- The Ruby Sanctum - Raid
    --- These should not be needed from my limited testing
    -- [14284] = 114, -- Borean Tundra - Battleground
    -- [14285] = 118, -- Icecrown - Battleground
    -- [14286] = 119, -- Sholazar Basin - Battleground
    -- [14287] = 115, -- Dragonblight - Battleground
    -- [14288] = 123, -- Wintergrasp - Battleground
}

spirit_healer_locs = {[1497]={{68.17,9.14}},[440]={{49.35,59.05},{53.9,28.8}},[406]={{36.44,75.24},{40.27,5.58},{57.53,61.34}},[15]={{46.62,57.08},{63.62,42.42},{39.49,31.45}},[36]={{42.93,38.0}},[490]={{50.0,56.03},{45.3,7.6},{80.33,50.28}},[1377]={{28.16,87.08},{47.22,37.27},{81.17,20.82}},[139]={{37.85,70.15},{39.15,93.74},{80.44,65.25},{47.27,44.89}},[10]={{19.99,49.21},{75.09,59.02}},[41]={{39.99,74.18}},[12]={{83.63,69.76},{39.48,60.55},{49.68,42.53}},[51]={{35.5,22.79}},[33]={{30.36,73.28},{38.38,8.97}},[4]={{51.07,12.06}},[8]={{50.31,62.4}},[40]={{51.71,49.67}},[44]={{20.78,56.56}},[46]={{64.13,24.06}},[3]={{8.44,55.32},{56.66,23.69}},[38]={{32.56,46.99}},[11]={{11.01,43.79},{49.34,41.76}},[45]={{48.84,55.61}},[267]={{51.83,52.55},{64.46,19.69}},[47]={{73.06,68.25},{16.94,44.51}},[130]={{44.15,42.52}},[28]={{44.97,85.97},{65.83,74.24}},[85]={{82.0,69.64},{30.8,64.9},{56.22,49.42},{78.97,40.98}},[400]={{68.67,53.3},{30.56,23.02}},[357]={{31.83,48.2},{54.82,48.05},{72.97,44.51}},[215]={{42.63,78.13},{46.52,55.48}},[17]={{45.31,60.96},{60.22,39.75},{50.7,32.6}},[405]={{50.41,62.91}},[1638]={{56.69,19.11}},[14]={{57.22,73.26},{44.17,69.43},{53.49,44.47},{47.37,17.88}},[331]={{80.69,58.39},{40.49,52.76}},[16]={{14.02,78.62},{54.31,71.49},{70.38,16.07}},[361]={{56.76,87.04},{49.51,31.05}},[148]={{43.55,92.38},{41.81,36.57}},[618]={{61.46,35.41}},[493]={{62.2,70.07}},[1]={{54.38,39.23},{47.31,54.61},{29.98,69.53}},[141]={{56.22,63.29},{58.71,42.33}},[1657]={{77.67,25.92}}}

-- This is all for drawing a line on the map in zones that we're not currently in
-- We could just draw our line outside of the scrollframe and rotate it, and to be honest that may even be a better approach

local function GetMapSize() -- Return dimensions and offset of current map
	local currentMapID = WorldMapFrame:GetMapID()
	if not currentMapID then return end
	
	local mapID, topleft = C_Map.GetWorldPosFromMapPos(currentMapID, {x = 0, y = 0})
	local mapID, bottomright = C_Map.GetWorldPosFromMapPos(currentMapID, {x = 1, y = 1})
	if not mapID then return end
	
	local left, top = topleft.y, topleft.x
	local right, bottom = bottomright.y, bottomright.x
	local width, height = left - right, top - bottom
	return left, top, right, bottom, width, height, mapID
end

local function GetIntersect(px, py, a, sx, sy, ex, ey)
	a = (a + PI / 2) % (PI * 2)
	local dx, dy = -math.cos(a), math.sin(a)
	local d = dx * (sy - ey) + dy * (ex - sx)
	if d ~= 0 and dx ~= 0 then
		local s = (dx * (sy - py) - dy * (sx - px)) / d
		if s >= 0 and s <= 1 then
			local r = (sx + (ex - sx) * s - px) / dx
			if r >= 0 then
				return sx + (ex - sx) * s, sy + (ey - sy) * s, r, s
			end
		end
	end
end


local line_list = {}
local point_list = {}
local point_list_kalimdor = {}
for areaID, spirit_healer_list in pairs(spirit_healer_locs) do
  local last_position = nil
  for _, pos in ipairs(spirit_healer_list) do
	  local cont, gpos = C_Map.GetWorldPosFromMapPos(areaIdToUiMapId[areaID], {['x'] = pos[1]/100.0, ['y'] = pos[2]/100.0})
	  if cont == 0 then table.insert(point_list, {['x'] = gpos.x, ['y'] = gpos.y}) else  table.insert(point_list_kalimdor, {['x'] = gpos.x, ['y'] = gpos.y}) end
	  if last_position then
	    table.insert(line_list, {["p1"] = {['x'] = gpos.x, ['y'] = gpos.y}, ["p2"] = {['x'] = last_position.x, ['y'] = last_position.y}})
	  end
	  last_position = gpos
  end
end

for k, v in pairs(nodes) do
  if newToUiMapId[k] then
    for loc, _ in pairs(v) do
      local x = tonumber(tostring(loc):sub(1,4))/10000.0
      local y = tonumber(tostring(loc):sub(-4))/10000.0
      local cont, gpos = C_Map.GetWorldPosFromMapPos(newToUiMapId[k], {['x'] = x, ['y'] = y})
      if cont == 0 then table.insert(point_list, {['x'] = gpos.x, ['y'] = gpos.y}) else  table.insert(point_list_kalimdor, {['x'] = gpos.x, ['y'] = gpos.y}) end
    end
  end
end

locs = {}
locs2 = point_list
locs_kalimdor2 = point_list_kalimdor

local function getRatio(x, x1, x2) 
  if (x2 - x1) == 0 then
    return 0 
  end
  return (x - x1)/(x2 - x1)
end

local function rectContains(px, py, bx1, by1, bx2, by2)
    if (px >= bx1 and px <= bx2) or (px <= bx1 and px >= bx2) then
      if py >= by1 and py <= by2 then
	return 1, getRatio(px, bx1, bx2),getRatio(py, by2, by1) 
      end
    end
    return nil
end

local function GetIntersect2(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y)
    local denom = (p4y-p3y)*(p2x-p1x) - (p4x-p3x)*(p2y-p1y)
    if denom == 0 then
        return nil
    end
    local ua = ((p4x-p3x)*(p1y-p3y) - (p4y-p3y)*(p1x-p3x)) / denom
    if ua < 0 or ua > 1 then 
        return nil
    end
    local ub = ((p2x-p1x)*(p1y-p3y) - (p2y-p1y)*(p1x-p3x)) / denom
    if ub < 0 or ub > 1 then
        return nil
    end
    x = p1x + ua * (p2x-p1x)
    y = p1y + ua * (p2y-p1y)
    return x, y, (x - p3x) / (p4x - p3x), (y - p3y) / (p4y - p3y)
end

local WorldMapButton = WorldMapFrame:GetCanvas()

local WorldMapUpdated, PlayerFacing = false, 0


local function drawIcon(px, py, tex, cont_id) 
	if mapMapID == pMapID or onMap or sameInstanceish then else return end
	if not px then return end -- we somehow do not have coordinates
	--local left, top, right, bottom, width, height, mapMapID = GetMapSize()
	local left, top, right, bottom, width, height, mapMapID = GetMapSize()
	if not width or width == 0 then return end -- map has no size?


	local currentMapID = WorldMapFrame:GetMapID()
	local uiMapID, pos = C_Map.GetMapPosFromWorldPos(cont_id, {['x'] = px, ['y'] = py}, currentMapID)

	if pos.x < 0 or pos.x > 1  then return end
	if pos.y < 0 or pos.y > 1  then return end


	local mWidth, mHeight = WorldMapFrame:GetCanvas():GetSize()
	tex:SetPoint('CENTER', WorldMapButton, 'TOPLEFT', mWidth* pos.x, mHeight*-pos.y)

	-- tex:SetPoint("CENTER", test_frame, 0, -100)
	tex:Show()
end

local function drawLine(px, py, p2x, p2y, _line, start_point, end_point) 
		start_point:ClearAllPoints()
		end_point:ClearAllPoints()
		_line:Hide()
		if mapMapID == pMapID or onMap or sameInstanceish then else return end
		if not px then return end -- we somehow do not have coordinates
		--local left, top, right, bottom, width, height, mapMapID = GetMapSize()
		local left, top, right, bottom, width, height, mapMapID = GetMapSize()
		if not width or width == 0 then return end -- map has no size?
		
		
		local sameInstanceish = pMapID == mapMapID
		local onMap = false
		if sameInstanceish and (px <= left and px >= right and py <= top and py >= bottom) then
			mx, my = (left - px) / width, (top - py) / height
			onMap = true
		end

		local function findAndSetPoint(_point_frame, px, py, ox, oy, left, bottom, right, top, mWidth, mHeight)
			local rectx, recty, _inside, _top, _bottom, _left, _right
			_inside, rectx, recty = rectContains(px,py, left, bottom, right, top)
			if _inside then
			  _point_frame:SetPoint('CENTER', WorldMapButton, 'TOPLEFT', mWidth * rectx, -mHeight * recty)
			  return 1
			end
			_top, _, rectx, recty = GetIntersect2(px,py, ox, oy, left, top, right, top)
			if _top then
			  _point_frame:SetPoint('CENTER', WorldMapButton, 'TOPLEFT', mWidth * rectx, 0)
			  return 1
			end

			_bottom,_, rectx, recty = GetIntersect2(px,py, ox, oy, left, bottom, right, bottom)
			if _bottom then
			  _point_frame:SetPoint('CENTER', WorldMapButton, 'BOTTOMLEFT', mWidth * rectx, 0)
			  return 1
			end

			_left,_, rectx, recty = GetIntersect2(px,py, ox, oy, left, top, left, bottom)
			if _left then
			  _point_frame:SetPoint('CENTER', WorldMapButton, 'TOPLEFT', 0, -mHeight * recty)
			  return 1
			end

			_right,_, rectx, recty = GetIntersect2(px,py, ox, oy, right, top, right, bottom)
			if _right then
			  _point_frame:SetPoint('CENTER', WorldMapButton, 'TOPRIGHT', 0, -mHeight * recty)
			  return 1
			end
			return nil
		end

		local mWidth, mHeight = WorldMapFrame:GetCanvas():GetSize()
		if findAndSetPoint(start_point, px, py, p2x, p2y, left, bottom, right, top, mWidth, mHeight) and findAndSetPoint(end_point, p2x, p2y, px, py, left, bottom, right, top, mWidth, mHeight) then
			_line:Show()
		end
end


local LineFrame = CreateFrame('frame', nil, WorldMapButton)
LineFrame:SetAllPoints()
LineFrame:SetFrameLevel(15000)


line_frames = {}
start_points = {}
end_points = {}
lines = {}

for i=1,#voronoi_lines do
	local start_point = CreateFrame('frame', nil, LineFrame)
	start_point:SetSize(1, 1)
	table.insert(start_points, start_point)
	local end_point = CreateFrame('frame', nil, LineFrame)
	end_point:SetSize(1, 1)
	table.insert(end_points, end_point)
	local Line = LineFrame:CreateLine(nil, 'OVERLAY')
	Line:Hide()
	Line:SetTexture('interface/buttons/white8x8')
	Line:SetVertexColor(0.8, .2, .2, 0.6)
	Line:SetThickness(2)
	Line:SetStartPoint('CENTER', start_point, 0, 0)
	Line:SetEndPoint('CENTER', end_point, 0, 0)
	table.insert(lines, Line)
end

line_frames_kalimdor = {}
start_points_kalimdor = {}
end_points_kalimdor = {}
lines_kalimdor= {}

for i=1,#voronoi_lines_kalimdor do
	local start_point = CreateFrame('frame', nil, LineFrame)
	start_point:SetSize(1, 1)
	table.insert(start_points_kalimdor, start_point)
	local end_point = CreateFrame('frame', nil, LineFrame)
	end_point:SetSize(1, 1)
	table.insert(end_points_kalimdor, end_point)
	local Line = LineFrame:CreateLine(nil, 'OVERLAY')
	Line:Hide()
	Line:SetTexture('interface/buttons/white8x8')
	Line:SetVertexColor(0.8, .2, .2, 0.6)
	Line:SetThickness(2)
	Line:SetStartPoint('CENTER', start_point, 0, 0)
	Line:SetEndPoint('CENTER', end_point, 0, 0)
	table.insert(lines_kalimdor, Line)
end

points_ = {}
texs_ = {}

for _,v in ipairs(locs2) do
  local p = CreateFrame('frame', nil, LineFrame)
  p:SetHeight(40)
  p:SetWidth(40)
  local tex = p:CreateTexture(nil, 'OVERLAY')
  tex:SetTexture("Interface\\Addons\\LogoutSkips\\Media\\icon_x.blp")
  tex:SetDrawLayer("OVERLAY", 4)
  tex:SetHeight(15)
  tex:SetWidth(15)
  tex:Hide()
  table.insert(points_, p)
  table.insert(texs_, tex)
end

points_kalimdor_ = {}
texs_kalimdor_ = {}

for _,v in ipairs(locs_kalimdor2) do
  local p = CreateFrame('frame', nil, LineFrame)
  p:SetHeight(40)
  p:SetWidth(40)
  local tex = p:CreateTexture(nil, 'OVERLAY')
  tex:SetTexture("Interface\\Addons\\LogoutSkips\\Media\\icon_x.blp")
  tex:SetDrawLayer("OVERLAY", 4)
  tex:SetHeight(15)
  tex:SetWidth(15)
  tex:Hide()
  table.insert(points_kalimdor_, p)
  table.insert(texs_kalimdor_, tex)
end

local function update()
	if settings['disabled'] and showing then
	  for _,v in ipairs(lines) do
	      v:Hide()
	  end
	  for _,v in ipairs(lines_kalimdor) do
	      v:Hide()
	  end

	  for i,v in ipairs(locs2) do
	    texs_[i]:Hide()
	  end
	  for i,v in ipairs(locs_kalimdor2) do
	    texs_kalimdor_[i]:Hide()
	  end
	  showing = false
	  return 
	end

	local currentMapID = WorldMapFrame:GetMapID()
	local cont, _ = C_Map.GetWorldPosFromMapPos(currentMapID, {x = 0, y = 0})

	if cont == 0 and currentMapID ~= 947 then 
	  for i,v in ipairs(voronoi_lines) do
		drawLine(v[1], v[2], v[3], v[4], lines[i], start_points[i], end_points[i])
	  end
	  for _,v in ipairs(lines_kalimdor) do
	      v:Hide()
	  end
	elseif cont == 1 and currentMapID ~= 947 then
	  for i,v in ipairs(voronoi_lines_kalimdor) do
		drawLine(v[1], v[2], v[3], v[4], lines_kalimdor[i], start_points_kalimdor[i], end_points_kalimdor[i])
	  end
	  for _,v in ipairs(lines) do
	      v:Hide()
	  end
	else
	  for _,v in ipairs(lines) do
	      v:Hide()
	  end
	  for _,v in ipairs(lines_kalimdor) do
	      v:Hide()
	  end
	end

	for i,v in ipairs(locs2) do
	  texs_[i]:Hide()
	  if cont == 0 and currentMapID ~= 947 then
		  drawIcon(v.x, v.y, texs_[i], 0)
	  end
	end

	for i,v in ipairs(locs_kalimdor2) do
	  texs_kalimdor_[i]:Hide()
	  if cont == 1 and currentMapID ~= 947 then
		  drawIcon(v.x, v.y, texs_kalimdor_[i], 1)
	  end
	end

	WorldMapUpdated = false
	showing = true
end


LineFrame:SetScript('OnUpdate', function(self, elapsed)
  if WorldMapUpdated == false then 
    return 
  end
  update()
end)

hooksecurefunc(WorldMapFrame, 'OnMapChanged', function()
	WorldMapUpdated = true
end)

if settings['disabled'] then
  LogoutSkips_Toggle:SetText("Show LogoutSkips")
else
  LogoutSkips_Toggle:SetText("Hide LogoutSkips")
end

function LogoutSkips_Toggle_Click()
  settings['disabled'] = not settings['disabled']
  if settings['disabled'] then
    LogoutSkips_Toggle:SetText("Show LogoutSkips")
  else
    LogoutSkips_Toggle:SetText("Hide LogoutSkips")
  end
  update()
end
